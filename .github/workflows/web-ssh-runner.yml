name: Web SSH Runner

on:
  workflow_dispatch:

jobs:
  webssh:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
    - name: Install ttyd
      run: |
        sudo apt update
        sudo apt install -y ttyd

    - name: Start ttyd (no login)
      run: |
        nohup ttyd -p 7681 -i /bin/bash &

    - name: Install Tailscale
      run: |
        curl -fsSL https://tailscale.com/install.sh | sh
        sudo tailscale up --authkey=${{ secrets.TSKEY }} --hostname=webssh-runner

    - name: Enable funnel
      run: |
        sudo tailscale funnel 7681
        tailscale funnel status

    - name: Keep alive
      run: sleep infinity
